/**
 * Categories Mega Menu V2 - Renovyte Style
 */

class CategoriesMenu {
    constructor() {
        this.hub = document.getElementById('headerCategories');
        this.btn = document.getElementById('categoriesBtn');
        this.dropdown = document.getElementById('categoriesDropdown');
        this.content = this.dropdown?.querySelector('.mega-menu-content');

        this.isOpen = false;
        this.currentCategory = 'service'; // Default

        this.categoryData = {
            'service': {
                title: 'Service Parts',
                icon: 'fa-oil-can',
                items: [
                    { name: 'Air Filter', icon: 'fa-wind' },
                    { name: 'Oil Filter', icon: 'fa-filter' },
                    { name: 'Cabin Filter', icon: 'fa-fan' },
                    { name: 'Fuel Filter', icon: 'fa-gas-pump' },
                    { name: 'Gear Oil', icon: 'fa-bottle-droplet' },
                    { name: 'Engine Oil', icon: 'fa-oil-can' },
                    { name: 'Coolants', icon: 'fa-snowflake' },
                    { name: 'Brake Fluid', icon: 'fa-droplet' }
                ]
            },
            'tyres': {
                title: 'Tyres & Wheels',
                icon: 'fa-circle-notch',
                items: [
                    { name: 'Tyres', icon: 'fa-circle' },
                    { name: 'Rims', icon: 'fa-life-ring' },
                    { name: 'Lock Nuts', icon: 'fa-lock' },
                    { name: 'Wheel Tyres', icon: 'fa-truck-monster' },
                    { name: 'Wheel Caps', icon: 'fa-bullseye' },
                    { name: 'Emergency Kit', icon: 'fa-kit-medical' }
                ]
            },
            'braking': {
                title: 'Braking System',
                icon: 'fa-stop-circle',
                items: [
                    { name: 'Brake Shoes', icon: 'fa-shoe-prints' },
                    { name: 'Brake Linings', icon: 'fa-layer-group' },
                    { name: 'Brake Pads', icon: 'fa-pause' },
                    { name: 'Brake Disc', icon: 'fa-compact-disc' }
                ]
            },
            'lighting': {
                title: 'Lighting',
                icon: 'fa-lightbulb',
                items: [
                    { name: 'Xenon/LED Headlights', icon: 'fa-eye' },
                    { name: 'Bi-LED Projectors', icon: 'fa-bullseye' },
                    { name: 'LED Bulbs', icon: 'fa-lightbulb' },
                    { name: 'Fog Bulbs', icon: 'fa-cloud' },
                    { name: 'Tail Lights', icon: 'fa-traffic-light' },
                    { name: 'Corner Lights', icon: 'fa-angle-right' },
                    { name: 'Grille Lights', icon: 'fa-bars' }
                ]
            },
            'exterior': {
                title: 'Exterior Accessories',
                icon: 'fa-spray-can',
                items: [
                    { name: 'Engine Additives', icon: 'fa-flask' },
                    { name: 'Car Perfume', icon: 'fa-wind' },
                    { name: 'Android Radio', icon: 'fa-music' },
                    { name: 'GPS Tracker', icon: 'fa-location-dot' },
                    { name: 'Door Visors', icon: 'fa-umbrella' },
                    { name: 'Steering Covers', icon: 'fa-circle-notch' },
                    { name: 'Dashcam', icon: 'fa-video' },
                    { name: 'Floor Mats', icon: 'fa-rug' },
                    { name: 'Seat Covers', icon: 'fa-chair' }
                ]
            },
            'body': {
                title: 'Body Parts',
                icon: 'fa-car-side',
                items: [
                    { name: 'Bonnet', icon: 'fa-angle-up' },
                    { name: 'Bumper (Front & Rear)', icon: 'fa-minus' },
                    { name: 'Fender', icon: 'fa-shield-halved' },
                    { name: 'Tail Gate', icon: 'fa-door-open' },
                    { name: 'Side Mirror', icon: 'fa-magnifying-glass' },
                    { name: 'Grille Guards', icon: 'fa-bars' },
                    { name: 'Headlights', icon: 'fa-lightbulb' }
                ]
            },
            'engine': {
                title: 'Engine & Components',
                icon: 'fa-engine',
                items: [
                    { name: 'Cylinder Head Gasket', icon: 'fa-ring' },
                    { name: 'Top Valve Gaskets', icon: 'fa-circle' },
                    { name: 'Timing Belt', icon: 'fa-rotate' },
                    { name: 'Crankshaft', icon: 'fa-gears' },
                    { name: 'Water Pump', icon: 'fa-pump-soap' },
                    { name: 'Spark Plugs', icon: 'fa-bolt' },
                    { name: 'Piston Rings', icon: 'fa-circle-notch' },
                    { name: 'Fuel Pump', icon: 'fa-gas-pump' },
                    { name: 'Coils', icon: 'fa-car-battery' }
                ]
            },
            'suspension': {
                title: 'Suspension & Steering',
                icon: 'fa-gauge-high',
                items: [
                    { name: 'CV Boot', icon: 'fa-shoe-prints' },
                    { name: 'Bearings', icon: 'fa-spinner' },
                    { name: 'Stabilizer Links', icon: 'fa-link' },
                    { name: 'Shocks', icon: 'fa-up-down' },
                    { name: 'Rack Ends', icon: 'fa-left-right' },
                    { name: 'CV Joints', icon: 'fa-joint' },
                    { name: 'Bushes', icon: 'fa-circle' },
                    { name: 'Tie Rods', icon: 'fa-arrows-left-right-to-line' },
                    { name: 'Ball Joints', icon: 'fa-bowling-ball' }
                ]
            }
        };

        this.init();
    }

    init() {
        if (!this.hub) return;

        // Hover events for Desktop
        if (window.innerWidth > 992) {
            this.hub.addEventListener('mouseenter', () => this.openDropdown());
            this.hub.addEventListener('mouseleave', () => this.closeDropdown());
        }

        // Click for Mobile / Button click
        this.btn?.addEventListener('click', (e) => {
            e.stopPropagation();
            if (window.innerWidth <= 992) {
                this.toggleDropdown();
            } else {
                window.location.href = 'catalog.html';
            }
        });

        // Close on outside click
        document.addEventListener('click', (e) => {
            if (this.isOpen && !this.hub.contains(e.target)) {
                this.closeDropdown();
            }
        });

        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') this.closeDropdown();
        });
    }

    toggleDropdown() {
        this.isOpen ? this.closeDropdown() : this.openDropdown();
    }

    openDropdown() {
        this.isOpen = true;
        this.dropdown.classList.add('active');
        this.btn.classList.add('active');
        this.renderMegaMenu();
    }

    closeDropdown() {
        this.isOpen = false;
        this.dropdown.classList.remove('active');
        this.btn.classList.remove('active');
    }

    renderMegaMenu() {
        if (!this.content) return;

        this.content.innerHTML = `
            <div class="mega-sidebar">
                ${Object.keys(this.categoryData).map(key => `
                    <div class="mega-category-item ${this.currentCategory === key ? 'active' : ''}" data-cat="${key}">
                        <span>${this.categoryData[key].title}</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                `).join('')}
            </div>
            <div class="mega-main">
                <div class="mega-title">${this.categoryData[this.currentCategory].title}</div>
                <div class="mega-grid">
                    ${this.categoryData[this.currentCategory].items.map(item => `
                        <a href="catalog.html?category=${this.currentCategory}&item=${encodeURIComponent(item.name)}" class="mega-subcategory-link">
                            <i class="fas ${item.icon}"></i>
                            <span>${item.name}</span>
                        </a>
                    `).join('')}
                </div>
            </div>
        `;

        // Add listeners to sidebar items
        this.content.querySelectorAll('.mega-category-item').forEach(item => {
            item.addEventListener('mouseenter', () => {
                this.currentCategory = item.dataset.cat;
                this.renderMegaMenu();
            });
        });
    }
}

// Global initialization
window.addEventListener('load', () => {
    window.categoriesMenu = new CategoriesMenu();
});
